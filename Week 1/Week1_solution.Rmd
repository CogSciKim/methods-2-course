---
title: "week1solutions"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
pacman::p_load(tidyverse,caret)
```

## Exercise 1.2

a)
```{r}
x <- seq(0,4,0.5)
x_pred <- x*10 + 30

rnorm(n=9,mean=x_pred,sd=3.9)
```


b)
```{r}
x_pred <- x*10 + 30
rnorm(n=9,mean=x_pred,sd=10)

```


## Custom dataset
```{r}
cov <- read_csv("../owid-covid-data.csv")

cov_day <- cov %>%
  filter(substr(iso_code,1,4) != "OWID") %>%
  select(location,continent,date,new_cases,population_density,total_cases,life_expectancy,gdp_per_capita) %>% 
  filter(date == as.Date("2022-02-01")) %>%
  na.omit()

set.seed(123)
training_indices <- cov_day$new_cases %>%
  createDataPartition(p = 0.8, list = FALSE)

training <- cov_day[training_indices,]
valid <- cov_day[-training_indices,]

training
cov_day

mod1 <- lm(new_cases~population_density, training)
mod2 <- lm(new_cases~population_density+total_cases, training)
mod3 <- lm(new_cases~gdp_per_capita, cov_day)
mod4 <- lm(new_cases~population_density+total_cases+gdp_per_capita, training)
mod5 <- lm(new_cases~continent, training)
mod6 <- lm(new_cases~continent+gdp_per_capita*population_density, training)
mod7 <- lm(new_cases~total_cases+gdp_per_capita, training)

```

```{r}
AIC(mod1,mod2,mod3,mod4,mod5,mod6,mod7)
```
```{r}
predictions <- mod7 %>% predict(valid)

data.frame(predictions,valid$new_cases)
```
```{r}
summary(mod7)
```
A model fitting total new cases of Covid-19 on 1/2/22 per country to total cases and per capita GDP has been derived. 
A significant slope was identified for both predictors with a non-significant intercept. 

Model fit is highly significant, yet explained variance is relatively low at adjusted $R^2=0.68$. This is reflected in predictive capability as demonstrated in the above table.



## Exercise 2.3
```{r}
names_df <- read_csv("../Data for the book/Names/data/allnames_clean.csv")

names_df <- names_df %>% 
  filter(sex == "F")

names_df$last_letter <- stri_sub(names_df$name,-1)

lastletter_df <- names_df %>% 
  group_by(last_letter) %>% 
  summarise_at(vars(X1880:X2010),sum) %>% 
  pivot_longer(starts_with("X"),names_to="Year") %>% 
  mutate(Year = str_sub(Year,-4))

lastletter_df$Year <- as.numeric(lastletter_df$Year)

for (year in unique(lastletter_df$Year))
  {
  total <- lastletter_df %>% 
    filter(Year == year) %>% 
    summarise(value) %>% 
    sum()
  lastletter_df <- lastletter_df %>% 
    mutate(value = ifelse(Year == year, value/total, value)) 
  }

lastletter_df

lastletter_df %>% 
  ggplot()+aes(x=Year,y=value,colour=last_letter)+geom_smooth(se=F)

```

